---
interface Props {
  event: any;
}

const { event = {} } = Astro.props as Props;

function formatDate(ms: any) {
  try {
    const d = new Date(Number(ms));
    return d.toLocaleString();
  } catch {
    return '';
  }
}

// Pick a gentle color based on id so cards vary subtly
function accentColor(id: number | string) {
  const colors = [
    'from-pink-300 to-pink-100',
    'from-indigo-300 to-indigo-100',
    'from-emerald-300 to-emerald-100',
    'from-amber-300 to-amber-100',
    'from-rose-300 to-rose-100',
  ];
  const i = Number(String(id).split('').reduce((s, c) => s + c.charCodeAt(0), 0)) || 0;
  return colors[i % colors.length];
}
---

<article class="group bg-white/70 backdrop-blur-sm border border-slate-100 rounded-2xl shadow-md overflow-hidden transition-transform hover:scale-[1.01] focus-within:scale-[1.01]">
  <div class={`h-2 w-full bg-gradient-to-r ${accentColor(event?.id ?? 0)}`} aria-hidden="true"></div>

  <div class="p-4 sm:p-5 flex gap-4 items-start">
    <!-- reserved logo / avatar space -->
    <div class="flex-shrink-0">
      <div class="w-14 h-14 rounded-lg bg-slate-100 flex items-center justify-center ring-1 ring-slate-200">
        <!-- Empty slot for future logo; show initials if available -->
        <span class="text-sm font-semibold text-slate-700">{event?.title ? String(event.title).split(' ').slice(0,2).map((t: string) => t[0]).join('').toUpperCase() : 'EV'}</span>
      </div>
    </div>

    <div class="flex-1 min-w-0">
      <header class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <h3 class="text-base sm:text-lg font-semibold text-slate-900 truncate">{event?.title}</h3>
          <p class="text-xs sm:text-sm text-slate-500 mt-0.5 truncate">{event?.location}</p>
        </div>

        <div class="text-right">
          <time datetime={event?.eventDate} class="block text-xs text-slate-400">{formatDate(event?.eventDate)}</time>
          <a class="inline-block mt-2 text-xs font-medium text-sky-600 hover:underline focus:outline-none focus:ring-2 focus:ring-sky-200 rounded" href={event?.url}>View</a>
        </div>
      </header>

      <p class="mt-3 text-sm text-slate-700 line-clamp-3">{event?.description ? String(event.description).slice(0, 300) + (String(event.description).length > 300 ? '\u2026' : '') : 'No description'}</p>

      <div class="mt-4 flex items-center justify-between text-xs text-slate-400">
        <div class="flex items-center gap-2">
          <span class="px-2 py-1 bg-slate-50 rounded-full text-slate-600">{event?.cityName ?? '—'}</span>
          <span class="text-slate-300">•</span>
          <span>{event?.districtName ?? '—'}</span>
        </div>
        <div class="text-right">
          <span class="text-slate-400">{event?.capacity ? `${event.capacity} seats` : ''}</span>
        </div>
      </div>
    </div>
  </div>
</article>

      <div class="flex-1 min-w-0">
        <header class="flex items-start justify-between gap-3">
          <div class="min-w-0">
            <h3 class="text-base sm:text-lg font-semibold text-slate-900 truncate">{event?.title}</h3>
            <p class="text-xs sm:text-sm text-slate-500 mt-0.5 truncate">{event?.location}</p>
          </div>

          <div class="text-right">
            <time datetime={event?.eventDate} class="block text-xs text-slate-400">{formatDate(event?.eventDate)}</time>
            <a class="inline-block mt-2 text-xs font-medium text-sky-600 hover:underline focus:outline-none focus:ring-2 focus:ring-sky-200 rounded" href={event?.url}>View</a>
          </div>
        </header>

    <p class="mt-3 text-sm text-slate-700 line-clamp-3">{event?.description ? event.description.slice(0, 300) + (event.description.length > 300 ? '\u2026' : '') : 'No description'}</p>

        <div class="mt-4 flex items-center justify-between text-xs text-slate-400">
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 bg-slate-50 rounded-full text-slate-600">{event?.cityName ?? '—'}</span>
            <span class="text-slate-300">•</span>
            <span>{event?.districtName ?? '—'}</span>
          </div>
          <div class="text-right">
            <span class="text-slate-400">{event?.capacity ? `${event.capacity} seats` : ''}</span>
          </div>
        </div>
      </div>
    </div>
  </article>
